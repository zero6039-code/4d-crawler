<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4D æˆç»© Malaysia Â· å®æ—¶æ›´æ–°</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        /* æ ·å¼ä¿æŒä¸æ‚¨ä¹‹å‰æä¾›çš„å®Œå…¨ä¸€è‡´ï¼Œæ­¤å¤„çœç•¥ä»¥èŠ‚çœç¯‡å¹…ï¼Œå®é™…ä½¿ç”¨æ—¶è¯·ä¿ç•™åŸæ · */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { background: #f0f2f5; padding: 15px 10px; }
        .container { max-width: 1300px; margin: 0 auto; }
        h1 { font-size: 2.2rem; font-weight: 800; text-align: center; margin-bottom: 15px; background: linear-gradient(135deg, #0b1c2f, #2c3e50); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: 1px; }
        .date-selector { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .date-dropdown { position: relative; display: inline-block; }
        .date-btn { background: #ffffffcc; backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.8); border-radius: 25px; padding: 8px 20px; font-size: 1rem; font-weight: 500; color: #2c3e50; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); transition: all 0.2s; }
        .date-btn:hover { background: #ffffff; box-shadow: 0 6px 16px rgba(0,0,0,0.1); }
        .date-btn .arrow { font-size: 0.8rem; transition: transform 0.2s; }
        .date-btn.active .arrow { transform: rotate(180deg); }
        .date-dropdown-content { display: none; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: white; border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); min-width: 220px; max-height: 300px; overflow-y: auto; z-index: 1000; margin-top: 8px; border: 1px solid #e2e8f0; }
        .date-dropdown.show .date-dropdown-content { display: block; }
        .date-option { padding: 10px 16px; cursor: pointer; transition: background 0.2s; border-bottom: 1px solid #f0f0f0; }
        .date-option:hover { background: #f0f2f5; }
        .date-option.active { background: #e6f0ff; color: #3182ce; font-weight: 600; }
        .date-option .draw-no { font-size: 0.75rem; color: #7c8b9c; }
        .loading-history { text-align: center; padding: 20px; color: #7c8b9c; }
        .draw-info { background: #ffffffcc; backdrop-filter: blur(4px); border-radius: 40px; padding: 6px 20px 6px 25px; display: inline-flex; align-items: center; justify-content: center; gap: 20px; margin: 0 auto 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); font-weight: 500; color: #2c3e50; border: 1px solid rgba(255,255,255,0.8); left: 50%; position: relative; transform: translateX(-50%); white-space: nowrap; }
        .draw-info strong { color: #d32f2f; font-weight: 600; margin-right: 4px; }
        .refresh-btn { background: linear-gradient(135deg, #3182ce, #2c5282); color: white; border: none; padding: 5px 16px; border-radius: 20px; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all 0.2s; box-shadow: 0 2px 8px rgba(49,130,206,0.3); line-height: 1.4; }
        .refresh-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(49,130,206,0.4); }
        .companies-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .company-section { background: white; border-radius: 24px; box-shadow: 0 8px 20px rgba(0,20,30,0.1); margin-bottom: 0; padding: 14px 12px; border: 1px solid rgba(255,255,255,0.5); transition: transform 0.15s ease; }
        .company-section:hover { transform: translateY(-3px); box-shadow: 0 12px 24px rgba(0,0,0,0.12); }
        .company-section.loading { opacity: 0.6; pointer-events: none; }
        .company-section.error { border-color: #d32f2f; background: #ffebee; }
        .company-title { font-size: 1.6rem; font-weight: 800; margin-bottom: 4px; padding-left: 4px; background: linear-gradient(145deg, #1e2b3a, #2b3d55); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: 1px; display: flex; align-items: center; flex-wrap: wrap; gap: 8px; }
        .company-title::before { content: "ğŸ¯"; margin-right: 6px; font-size: 1.4rem; background: none; -webkit-text-fill-color: initial; }
        .draw-date { font-size: 0.9rem; color: #4a5568; margin-bottom: 10px; padding-left: 4px; font-weight: 500; }
        .prize-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin: 12px 0 16px; }
        .prize-card { background: #f8fafd; border-radius: 16px; padding: 10px 12px; flex: 1 1 90px; min-width: 80px; text-align: center; box-shadow: inset 0 1px 4px #ffffff, 0 5px 10px rgba(0,0,0,0.04); border: 1px solid #e9ecf0; }
        .prize-card .label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; color: #5f6b7a; font-weight: 500; margin-bottom: 4px; }
        .prize-card .number { font-size: 1.7rem; font-weight: 800; color: #c62828; line-height: 1.2; text-shadow: 2px 2px 0 rgba(198,40,40,0.1); font-family: 'Courier New', monospace; }
        .subsection { margin-top: 16px; background: #f9fbfd; border-radius: 16px; padding: 12px 10px; border: 1px solid #e2e8f0; }
        .subsection-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 4px; color: #1e2f3e; }
        .subsection-title::before { content: "âœ¨"; font-size: 1.2rem; }
        .number-list { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start; }
        .number-item { background: #ffffff; padding: 6px 10px; border-radius: 28px; font-family: 'Courier New', monospace; font-size: 1.1rem; font-weight: 600; color: #0b2a41; box-shadow: 0 3px 8px rgba(0,0,0,0.03); border: 1px solid #d4deec; min-width: 50px; text-align: center; transition: all 0.1s; white-space: pre-line; line-height: 1.4; }
        .number-item:hover { background: #e6f0ff; border-color: #8a9cb0; }
        .custom-table { width: 100%; border-collapse: collapse; margin-top: 8px; font-size: 0.9rem; }
        .custom-table th { background: #e2e8f0; padding: 8px 4px; text-align: center; font-weight: 600; color: #2d3748; border: 1px solid #cbd5e0; }
        .custom-table td { padding: 6px 4px; text-align: center; border: 1px solid #cbd5e0; background: white; }
        .custom-table .alt-number { color: #3182ce; font-weight: 500; }
        .group-subtitle { font-size: 0.95rem; font-weight: 600; margin: 8px 0 4px 0; color: #2c3e50; width: 100%; }
        footer { text-align: center; margin-top: 30px; color: #7c8b9c; font-size: 0.8rem; border-top: 1px solid #dbe1ea; padding-top: 16px; }
        @media (max-width: 900px) { .companies-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .companies-grid { grid-template-columns: 1fr; } .company-title { font-size: 1.5rem; } .prize-card .number { font-size: 1.6rem; } .number-item { font-size: 1.0rem; padding: 5px 8px; min-width: 45px; } }
        .company-section[data-company="damacai"] .company-title { background: linear-gradient(145deg, #1e5620, #2a7a2d); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="magnum"] .company-title { background: linear-gradient(145deg, #aa4a1e, #c95f2a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="toto"] .company-title { background: linear-gradient(145deg, #b71c1c, #d32f2f); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="singapore"] .company-title { background: linear-gradient(145deg, #1e4a6b, #2c6b96); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="damacai_1p3d"] .company-title { background: linear-gradient(145deg, #1e5620, #2a7a2d); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="sabah"] .company-title { background: linear-gradient(145deg, #8b4513, #b85e1e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="sandakan"] .company-title { background: linear-gradient(145deg, #4a2c1a, #6e4228); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="sarawak_cashsweep"] .company-title { background: linear-gradient(145deg, #0d4b4b, #127373); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="sportstoto_fireball"] .company-title { background: linear-gradient(145deg, #b3442c, #d45d3a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="sabah_lotto"] .company-title { background: linear-gradient(145deg, #b3442c, #d45d3a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="grand_dragon"] .company-title { background: linear-gradient(145deg, #a52a2a, #b84a4a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="singapore_toto"] .company-title { background: linear-gradient(145deg, #2c5282, #4299e1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="sportstoto_lotto"] .company-title { background: linear-gradient(145deg, #744210, #b7791f); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="magnum_jackpot_gold"] .company-title { background: linear-gradient(145deg, #b8860b, #d4af37); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="sportstoto_5d"] .company-title { background: linear-gradient(145deg, #1e4a6b, #2c6b96); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="sportstoto_6d"] .company-title { background: linear-gradient(145deg, #1e4a6b, #2c6b96); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .company-section[data-company="magnum_life"] .company-title { background: linear-gradient(145deg, #1e4a6b, #2c6b96); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }
        .status-indicator.success { background: #48bb78; }
        .status-indicator.error { background: #f56565; }
        .status-indicator.loading { background: #ecc94b; animation: blink 1s infinite; }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }
    </style>
</head>
<body>
    <div class="container">
        <h1>MY 4D RESULT MALAYSIA</h1>
        
        <!-- æ—¥æœŸé€‰æ‹©å™¨ï¼ˆä¸‹æ‹‰æŒ‰é’®ï¼‰ -->
        <div class="date-selector">
            <div class="date-dropdown" id="date-dropdown">
                <button class="date-btn" id="date-btn" onclick="toggleDateDropdown()">
                    <span id="selected-date">åŠ è½½ä¸­...</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="date-dropdown-content" id="date-dropdown-content">
                    <div class="loading-history">ğŸ”„ åŠ è½½å†å²æ•°æ®...</div>
                </div>
            </div>
        </div>
        
        <!-- æ—¥æœŸæ¡ï¼ˆæ—¥æœŸ+åˆ·æ–°æŒ‰é’®ï¼‰ -->
        <div class="draw-info">
            <span><strong>æ—¥æœŸï¼š</strong> <span id="draw_date">--</span></span>
            <button class="refresh-btn" id="refresh-btn" onclick="forceRefresh()">åˆ·æ–°</button>
        </div>

        <!-- å…¬å¸å¡ç‰‡ç½‘æ ¼ -->
        <div id="companies-grid" class="companies-grid">
            <p style="text-align: center; grid-column: 1/-1; color: #666;">ğŸ”„ æ­£åœ¨åŠ è½½æ•°æ®...</p>
        </div>

        <footer>
            âš ï¸ æ•°æ®ä»…ä¾›å‚è€ƒï¼Œè¯·ä»¥å®˜æ–¹å…¬å‘Šä¸ºå‡†ã€‚<br>
            <span id="status-text">
                <span class="status-indicator loading"></span>æ­£åœ¨åŠ è½½...
            </span>
            <br>
            æ›´æ–°äº <span id="update-time">-</span>
        </footer>
    </div>

    <script>
        // ==================== é…ç½® ====================
        const COMPANY_LIST = [
            'damacai', 'magnum', 'toto', 'singapore', 'damacai_1p3d',
            'sandakan', 'sarawak_cashsweep', 'sabah', 'sabah_lotto',
            'sportstoto_fireball', 'grand_dragon', 'singapore_toto',
            'sportstoto_lotto', 'magnum_jackpot_gold', 'sportstoto_5d',
            'sportstoto_6d', 'magnum_life'
        ];

        const NAME_MAP = {
            'damacai': 'DAMACAI 4D',
            'magnum': 'MAGNUM 4D',
            'toto': 'TOTO 4D',
            'singapore': 'SINGAPORE 4D',
            'damacai_1p3d': 'DAMACAI 1+3D',
            'sandakan': 'SANDAKAN 4D',
            'sarawak_cashsweep': 'SARAWAK CASHSWEEP',
            'sabah': 'SABAH 88 4D',
            'sabah_lotto': 'SABAH LOTTO',
            'sportstoto_fireball': 'SPORTSTOTO FIREBALL',
            'grand_dragon': 'GRAND DRAGON',
            'singapore_toto': 'SINGAPORE TOTO',
            'sportstoto_lotto': 'SPORTSTOTO LOTTO',
            'magnum_jackpot_gold': 'MAGNUM JACKPOT GOLD',
            'sportstoto_5d': 'SPORTSTOTO 5D',
            'sportstoto_6d': 'SPORTSTOTO 6D',
            'magnum_life': 'MAGNUM LIFE'
        };

        const SPECIAL_COMPANIES = [
            'sportstoto_fireball', 'sportstoto_lotto', 'singapore_toto',
            'magnum_jackpot_gold', 'sportstoto_5d', 'sportstoto_6d', 'magnum_life'
        ];

        let availableDates = [];
        let selectedDate = null;

        // ==================== æ—¥æœŸé€‰æ‹©å™¨åŠŸèƒ½ ====================
        function toggleDateDropdown() {
            document.getElementById('date-dropdown').classList.toggle('show');
            document.getElementById('date-btn').classList.toggle('active');
        }

        async function loadDateIndex() {
            try {
                const res = await fetch(`data/dates.json?t=${Date.now()}`, { cache: 'no-store' });
                if (res.ok) {
                    availableDates = await res.json();
                } else {
                    availableDates = [];
                }
            } catch (e) {
                console.warn('æ— æ³•åŠ è½½ dates.json', e);
                availableDates = [];
            }
            renderDateDropdown();
        }

        function renderDateDropdown() {
            const content = document.getElementById('date-dropdown-content');
            const btnSpan = document.getElementById('selected-date');
            if (!availableDates || availableDates.length === 0) {
                content.innerHTML = '<div class="loading-history">æš‚æ— å†å²æ•°æ®</div>';
                btnSpan.innerText = 'æœ€æ–°æ•°æ®';
                return;
            }
            let html = '<div class="date-option" onclick="selectDate(null)">ğŸ“Œ æœ€æ–°æ•°æ®</div>';
            availableDates.forEach(date => {
                const activeClass = (selectedDate === date) ? 'active' : '';
                html += `<div class="date-option ${activeClass}" onclick="selectDate('${date}')">ğŸ“… ${date}</div>`;
            });
            content.innerHTML = html;
        }

        function selectDate(date) {
            selectedDate = date;
            document.getElementById('selected-date').innerText = date ? date : 'æœ€æ–°æ•°æ®';
            document.getElementById('date-dropdown').classList.remove('show');
            document.getElementById('date-btn').classList.remove('active');
            loadAllCompanies();
        }

        // ==================== æ•°æ®åŠ è½½ ====================
        async function loadCompanyData(companyKey) {
            const basePath = selectedDate ? `data/${selectedDate}` : 'data';
            const url = `${basePath}/${companyKey}.json?t=${Date.now()}`;
            try {
                const res = await fetch(url, { cache: 'no-store' });
                if (res.ok) {
                    return await res.json();
                }
            } catch (err) {
                console.warn(`${companyKey} è¯·æ±‚å¤±è´¥`, err);
            }
            return null;
        }

        // ==================== åˆ›å»ºå¡ç‰‡éª¨æ¶ï¼ˆé¦–æ¬¡åŠ è½½ï¼‰====================
        function createCompanySkeletons() {
            const grid = document.getElementById('companies-grid');
            grid.innerHTML = '';
            COMPANY_LIST.forEach(companyKey => {
                const section = document.createElement('div');
                section.className = 'company-section';
                section.id = `company-${companyKey}`;
                section.setAttribute('data-company', companyKey);

                const titleDiv = document.createElement('div');
                titleDiv.className = 'company-title';
                titleDiv.innerText = NAME_MAP[companyKey] || companyKey.replace(/_/g, ' ').toUpperCase();
                section.appendChild(titleDiv);

                const metaDiv = document.createElement('div');
                metaDiv.className = 'draw-date';
                metaDiv.id = `meta-${companyKey}`;
                metaDiv.innerText = 'ğŸ“… æ—¥æœŸ: -- | ğŸŸï¸ æœŸå·: --';
                section.appendChild(metaDiv);

                const contentDiv = document.createElement('div');
                contentDiv.className = 'company-content';
                contentDiv.id = `content-${companyKey}`;
                contentDiv.innerHTML = '<p style="text-align:center;color:#999;">åŠ è½½ä¸­...</p>';
                section.appendChild(contentDiv);

                grid.appendChild(section);
            });
        }

        // ==================== æ›´æ–°å•ä¸ªå…¬å¸å¡ç‰‡ ====================
        function updateCompanyCard(companyKey, data) {
            const contentDiv = document.getElementById(`content-${companyKey}`);
            const metaDiv = document.getElementById(`meta-${companyKey}`);
            if (!contentDiv || !metaDiv) return;

            if (!data) {
                contentDiv.innerHTML = '<p style="text-align:center;color:#d32f2f;">åŠ è½½å¤±è´¥</p>';
                metaDiv.innerText = 'ğŸ“… æ—¥æœŸ: -- | ğŸŸï¸ æœŸå·: --';
                return;
            }

            const drawDate = data.draw_date || '--';
            const drawNo = data.draw_no || '--';
            metaDiv.innerText = `ğŸ“… æ—¥æœŸ: ${drawDate} | ğŸŸï¸ æœŸå·: ${drawNo}`;

            let html = '';

            if (SPECIAL_COMPANIES.includes(companyKey)) {
                if (companyKey === 'sportstoto_5d' && data.data) {
                    html += '<div class="custom-table">';
                    data.data.forEach(row => {
                        html += `<div style="display:flex;justify-content:space-between;padding:4px 0;"><span>${row[0]}</span><span class="number-item">${row[1]}</span></div>`;
                    });
                    html += '</div>';
                } else if (companyKey === 'sportstoto_6d' && data.data) {
                    html += '<div class="custom-table">';
                    data.data.forEach(row => {
                        html += `<div style="display:flex;justify-content:space-between;padding:4px 0;"><span>${row[0]}</span><span class="number-item">${row[1]}</span><span class="alt-number">${row[2] || ''}</span></div>`;
                    });
                    html += '</div>';
                } else if (companyKey === 'singapore_toto' && data.winning_numbers) {
                    html += `<div class="subsection-title">å¼€å¥–å·ç </div>`;
                    html += `<div class="number-list">${data.winning_numbers.map(n => `<span class="number-item">${n}</span>`).join('')}</div>`;
                    if (data.prize_table) {
                        html += `<div class="subsection-title">å¥–é‡‘åˆ†é…</div>`;
                        html += `<table class="custom-table"><tr><th>Prize Group</th><th>Amount</th><th>Winners</th></tr>`;
                        data.prize_table.forEach(row => {
                            html += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td></tr>`;
                        });
                        html += `</table>`;
                    }
                } else {
                    html = '<p style="text-align:center;">ç‰¹æ®Šæ•°æ®æ ¼å¼</p>';
                }
            } else {
                html = `
                    <div class="prize-grid" style="flex-direction:column;align-items:center;">
                        <div style="display:flex;justify-content:center;width:100%;margin-bottom:4px;">
                            <div class="prize-card" style="flex:0 0 220px;"><div class="label">1st Prize</div><div class="number">${data['1st'] || '----'}</div></div>
                        </div>
                        <div style="display:flex;justify-content:center;gap:8px;width:100%;">
                            <div class="prize-card" style="flex:1;"><div class="label">2nd Prize</div><div class="number">${data['2nd'] || '----'}</div></div>
                            <div class="prize-card" style="flex:1;"><div class="label">3rd Prize</div><div class="number">${data['3rd'] || '----'}</div></div>
                        </div>
                    </div>
                `;

                if (data.special && data.special.length > 0) {
                    html += `<div class="subsection"><div class="subsection-title">ğŸ ç‰¹åˆ«å¥– (Special)</div><div class="number-list">`;
                    data.special.forEach(num => { html += `<span class="number-item">${num}</span>`; });
                    html += `</div></div>`;
                }

                if (data.consolation && data.consolation.length > 0) {
                    html += `<div class="subsection"><div class="subsection-title">ğŸ˜Œ å®‰æ…°å¥– (Consolation)</div><div class="number-list">`;
                    data.consolation.forEach(num => { html += `<span class="number-item">${num}</span>`; });
                    html += `</div></div>`;
                }
            }

            contentDiv.innerHTML = html;
        }

        async function loadAllCompanies() {
            const statusText = document.getElementById('status-text');
            const drawDateSpan = document.getElementById('draw_date');
            const updateTimeSpan = document.getElementById('update-time');

            statusText.innerHTML = '<span class="status-indicator loading"></span>æ­£åœ¨æ›´æ–°...';

            try {
                const promises = COMPANY_LIST.map(key => loadCompanyData(key));
                const results = await Promise.all(promises);

                let successCount = 0;
                results.forEach((data, idx) => {
                    const companyKey = COMPANY_LIST[idx];
                    updateCompanyCard(companyKey, data);
                    if (data) successCount++;
                });

                const firstValid = results.find(d => d && d.draw_date);
                if (firstValid) {
                    drawDateSpan.innerText = firstValid.draw_date;
                } else {
                    drawDateSpan.innerText = selectedDate || '--';
                }

                statusText.innerHTML = `<span class="status-indicator ${successCount === COMPANY_LIST.length ? 'success' : 'error'}"></span>${successCount}/${COMPANY_LIST.length} å®¶å…¬å¸æ›´æ–°æˆåŠŸ`;
                updateTimeSpan.innerText = new Date().toLocaleString('en-GB', { timeZone: 'Asia/Kuala_Lumpur' });

            } catch (err) {
                console.error(err);
                statusText.innerHTML = '<span class="status-indicator error"></span>æ›´æ–°å¤±è´¥';
            }
        }

        function forceRefresh() {
            loadAllCompanies();
        }

        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', async () => {
            await loadDateIndex();
            createCompanySkeletons();
            await loadAllCompanies();
            setInterval(loadAllCompanies, 60000);
        });

        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) loadAllCompanies();
        });

        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('date-dropdown');
            if (dropdown && !dropdown.contains(e.target)) {
                dropdown.classList.remove('show');
                document.getElementById('date-btn')?.classList.remove('active');
            }
        });
    </script>
</body>
</html>
